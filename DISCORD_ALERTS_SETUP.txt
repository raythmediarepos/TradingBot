================================================================================
ðŸš¨ DISCORD ALERTS SETUP GUIDE
================================================================================

Status: âœ… IMPLEMENTED
Location: backend/services/monitoring/alertService.js
Cost: $0 (uses existing Discord bot)

================================================================================
âœ… WHAT WAS BUILT
================================================================================

A Discord-based alerting system that:
- ðŸš¨ Sends beautiful embeds to Discord when issues detected
- ðŸ‘¥ Tags admins for CRITICAL alerts only
- ðŸŽ¨ Color-coded by severity (Red/Orange/Blue)
- ðŸ“Š Includes all alert details
- ðŸ”— Links to admin dashboard
- ðŸ’¾ Stores alerts in Firebase
- ðŸ”• Prevents duplicate alerts

================================================================================
ðŸŽ¯ ALERT TYPES & BEHAVIOR
================================================================================

ðŸ”´ CRITICAL Alerts:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Red embed
â€¢ Tags all admins (@mention)
â€¢ Triggers: API down, email bounce rate >5%
â€¢ Message: "ðŸš¨ CRITICAL ALERT"

Example:
```
@admin ðŸš¨ CRITICAL ALERT

[RED EMBED]
ðŸš¨ System Alert
API is not healthy

ðŸ”§ Service: API
ðŸ“Š Severity: CRITICAL
ðŸ”— Actions: [View Dashboard]
```

ðŸŸ¡ WARNING Alerts:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Orange embed
â€¢ NO admin tags
â€¢ Triggers: API slow >2s, uptime <99%, email delivery <95%

Example:
```
[ORANGE EMBED]
âš ï¸  System Alert
API response time elevated: 2500ms

ðŸ”§ Service: API
ðŸ“Š Severity: WARNING
ðŸŽ¯ Threshold: 2000
ðŸ“ˆ Actual: 2500
ðŸ”— Actions: [View Dashboard]
```

ðŸ”µ INFO Alerts:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Blue embed
â€¢ NO admin tags
â€¢ Triggers: Email verification rate <70%

Example:
```
[BLUE EMBED]
â„¹ï¸  System Alert
Email verification rate low: 65%

ðŸ”§ Service: USERS
ðŸ“Š Severity: INFO
ðŸŽ¯ Threshold: 70
ðŸ“ˆ Actual: 65
ðŸ”— Actions: [View Dashboard]
```

================================================================================
ðŸš€ SETUP STEPS (5 MINUTES)
================================================================================

STEP 1: Create Discord Alerts Channel
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Open your Discord server
2. Create a new channel:
   - Name: `#system-alerts` (or any name)
   - Type: Text channel
   - Category: Optional (maybe "Admin" or "Management")
3. Set permissions (IMPORTANT!):
   - @everyone: âŒ Can't view channel
   - Bot: âœ… View + Send Messages + Embed Links
   - Admins: âœ… View + Manage Messages

STEP 2: Get Channel ID
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Enable Developer Mode in Discord:
   - Settings > App Settings > Advanced
   - Toggle "Developer Mode" ON

2. Get the channel ID:
   - Right-click on `#system-alerts` channel
   - Click "Copy Channel ID"
   - Save it (e.g., 1234567890123456789)

STEP 3: Get Your User ID (for tagging)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Right-click on your username (in server member list)
2. Click "Copy User ID"
3. Save it (e.g., 9876543210987654321)

For multiple admins:
- Get each admin's user ID
- Separate with commas: 123456,789012,345678

STEP 4: Add Environment Variables to Render
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Go to Render > Your Backend Service > Environment

Add these 2 variables:

1. DISCORD_ALERTS_CHANNEL_ID
   Value: [paste channel ID from Step 2]

2. DISCORD_ADMIN_IDS
   Value: [paste your user ID(s) from Step 3]
   
   Examples:
   - Single admin: 123456789012345678
   - Multiple admins: 123456789012345678,987654321098765432

3. Save Changes

Render will auto-redeploy!

STEP 5: Test! (Optional)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

After deployment, you can manually trigger an alert:

1. Go to Render logs
2. Look for: "âœ… [ALERTS] Discord client initialized for alerts"
3. Wait 15 minutes for first metrics check
4. If no issues, you won't see alerts (good!)

To force a test alert (temporary):
- Temporarily lower a threshold in alertService.js
- Or temporarily stop your frontend
- Wait for health check to detect it

================================================================================
ðŸ“º WHAT YOU'LL SEE
================================================================================

RENDER LOGS (On Deployment):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

```
ðŸš€ Helwa AI Backend running on port 5000
âœ… Discord bot started

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸ“Š [MONITORING] Initializing monitoring system...
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… [ALERTS] Discord client initialized for alerts
   âœ… Discord alerts enabled
âš¡ [MONITORING] Running initial health check...

... health checks run ...

ðŸ”” [ALERT] Checking for issues...
   â†’ No alerts needed âœ…
```

DISCORD CHANNEL (When Alert Triggered):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Critical Alert:
```
@YourUsername ðŸš¨ CRITICAL ALERT

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸš¨ System Alert                    â”‚
â”‚                                    â”‚
â”‚ API is not healthy                 â”‚
â”‚                                    â”‚
â”‚ ðŸ”§ Service        API              â”‚
â”‚ ðŸ“Š Severity       CRITICAL         â”‚
â”‚ ðŸ”— Actions        [View Dashboard] â”‚
â”‚                                    â”‚
â”‚ Helwa AI Monitoring System         â”‚
â”‚ Nov 11, 2025 at 10:30 AM          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Warning Alert (No Tag):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸  System Alert                   â”‚
â”‚                                    â”‚
â”‚ API response time elevated: 2500ms â”‚
â”‚                                    â”‚
â”‚ ðŸ”§ Service        API              â”‚
â”‚ ðŸ“Š Severity       WARNING          â”‚
â”‚ ðŸŽ¯ Threshold      2000             â”‚
â”‚ ðŸ“ˆ Actual         2500             â”‚
â”‚ ðŸ”— Actions        [View Dashboard] â”‚
â”‚                                    â”‚
â”‚ Helwa AI Monitoring System         â”‚
â”‚ Nov 11, 2025 at 10:45 AM          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

================================================================================
ðŸ”§ ENVIRONMENT VARIABLES REFERENCE
================================================================================

REQUIRED:
â”€â”€â”€â”€â”€â”€â”€â”€â”€
DISCORD_ALERTS_CHANNEL_ID
â€¢ What: Channel ID where alerts are sent
â€¢ How to get: Right-click channel > Copy Channel ID
â€¢ Example: 1401079321476731052

DISCORD_ADMIN_IDS
â€¢ What: User IDs to tag for critical alerts
â€¢ How to get: Right-click user > Copy User ID
â€¢ Example (single): 123456789012345678
â€¢ Example (multiple): 123456789012345678,987654321098765432
â€¢ Note: Separate multiple IDs with commas (no spaces)

OPTIONAL:
â”€â”€â”€â”€â”€â”€â”€â”€â”€
FRONTEND_URL
â€¢ What: Link to dashboard in alert embeds
â€¢ Example: https://trading-bot-7fi8.vercel.app
â€¢ Default: If not set, shows generic "Check dashboard" text

================================================================================
ðŸŽ¨ CUSTOMIZATION
================================================================================

Want to customize alerts? Edit these in alertService.js:

COLORS:
â”€â”€â”€â”€â”€â”€â”€
const getSeverityColor = (severity) => {
  const colors = {
    critical: 0xFF0000, // Red
    warning: 0xFFA500,  // Orange
    info: 0x0099FF,     // Blue
  }
  return colors[severity] || 0x808080
}

EMOJIS:
â”€â”€â”€â”€â”€â”€â”€
const getSeverityEmoji = (severity) => {
  const emojis = {
    critical: 'ðŸš¨',
    warning: 'âš ï¸',
    info: 'â„¹ï¸',
  }
  return emojis[severity] || 'ðŸ“¢'
}

THRESHOLDS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Edit in checkThresholds() function:
â€¢ API response time: Change `> 2000` to any value (ms)
â€¢ Uptime: Change `< 99` to any percentage
â€¢ Bounce rate: Change `> 5` to any percentage
â€¢ Delivery rate: Change `< 95` to any percentage

================================================================================
ðŸ”• ALERT MANAGEMENT
================================================================================

PREVENTING ALERT SPAM:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Already implemented!
â€¢ Same alert won't be sent twice within 1 hour
â€¢ Checked in checkAndAlert() function
â€¢ Stored in Firebase for deduplication

MANAGING ALERT VOLUME:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Too many alerts?
1. Adjust thresholds (make them less sensitive)
2. Disable info alerts:
   - Comment out info severity in checkThresholds()
3. Add quiet hours:
   - Check time before sending
   - Skip non-critical during night

ACKNOWLEDGING ALERTS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Currently alerts are for notification only.
Future improvements could add:
â€¢ React with âœ… emoji to acknowledge
â€¢ Bot responds "Acknowledged by @user"
â€¢ Updates Firebase alert record

================================================================================
ðŸ“Š ALERT HISTORY
================================================================================

All alerts are stored in Firebase:

Collection: alerts

Fields:
â€¢ severity: 'critical' | 'warning' | 'info'
â€¢ service: 'api' | 'email' | 'users' | 'system'
â€¢ message: Description
â€¢ threshold: Expected value
â€¢ actual: Current value
â€¢ sentAt: Timestamp
â€¢ acknowledged: boolean (default: false)

View in:
â€¢ Firebase Console > Firestore > alerts collection
â€¢ (Future) Admin dashboard > System Health > Alerts tab

================================================================================
â“ TROUBLESHOOTING
================================================================================

ISSUE: No alerts appearing in Discord
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Fix:
1. Check Render logs for:
   "âœ… [ALERTS] Discord client initialized for alerts"
   
2. If you see:
   "âš ï¸  Discord bot not available - alerts will be Firebase only"
   â†’ Discord bot failed to start, check bot token

3. If you see:
   "âš ï¸  DISCORD_ALERTS_CHANNEL_ID not set"
   â†’ Add the env var to Render

4. If you see:
   "âŒ Could not find Discord alerts channel"
   â†’ Check channel ID is correct
   â†’ Check bot has permission to view channel

5. Check Firebase for alerts:
   â†’ If alerts exist in Firebase but not Discord
   â†’ Bot has permission issues

ISSUE: Admins not getting tagged
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Fix:
1. Check DISCORD_ADMIN_IDS is set
2. Check user ID is correct (right-click > Copy User ID)
3. For multiple admins, use commas: ID1,ID2,ID3
4. Make sure no spaces in the env var value

ISSUE: Bot can't send messages
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Fix:
1. Check bot permissions in channel:
   â†’ View Channel: âœ…
   â†’ Send Messages: âœ…
   â†’ Embed Links: âœ…
2. Bot role must be ABOVE other roles to tag them
3. Try moving bot role higher in Server Settings > Roles

ISSUE: Alerts too frequent
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Fix:
1. Duplicate suppression is already enabled (1 hour)
2. Adjust thresholds to be less sensitive
3. Disable info level alerts
4. Add quiet hours (edit alertService.js)

ISSUE: Not receiving critical alerts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Fix:
1. Enable Discord mobile notifications
2. Check notification settings for #system-alerts
3. Make sure you're not muting the channel
4. Consider adding SMS backup for critical (Twilio)

================================================================================
ðŸ’¡ TIPS & BEST PRACTICES
================================================================================

CHANNEL ORGANIZATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Keep #system-alerts separate from other channels
âœ… Pin important/recurring alerts
âœ… Use channel topic to link to runbook/docs
âœ… Set slow mode if needed (prevent spam)

NOTIFICATION SETTINGS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Enable mobile notifications for #system-alerts
âœ… Set notification override for this channel (All Messages)
âœ… Add to favorites for quick access

RESPONSE WORKFLOW:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. See alert in Discord
2. Click "View Dashboard" link
3. Check Firebase for more details
4. Investigate issue
5. Fix problem
6. (Future) React with âœ… to acknowledge

ESCALATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
For critical issues:
1. Discord alert (immediate)
2. If not resolved in 15 min, manual escalation
3. (Future) Add SMS backup via Twilio

================================================================================
âœ… SUMMARY
================================================================================

ðŸŽ‰ YOU NOW HAVE:
âœ… Discord alerts for all system issues
âœ… Beautiful color-coded embeds
âœ… Admin tagging for critical alerts
âœ… Dashboard links in alerts
âœ… Alert history in Firebase
âœ… Duplicate prevention
âœ… COMPLETELY FREE ($0/month)

ðŸ“ TO COMPLETE SETUP:
1. Create #system-alerts channel
2. Get channel ID (right-click > Copy Channel ID)
3. Get your user ID (right-click > Copy User ID)
4. Add DISCORD_ALERTS_CHANNEL_ID to Render
5. Add DISCORD_ADMIN_IDS to Render
6. Save & wait for auto-deploy
7. Check logs for "Discord alerts enabled" âœ…

ðŸ’¬ TEST IT:
Wait 15 minutes for metrics check, or temporarily trigger an alert by:
â€¢ Stopping frontend (will trigger API health alert)
â€¢ Temporarily lowering threshold

Questions? Issues? Let me know! ðŸš€

Last Updated: November 11, 2025
Status: âœ… READY TO USE

